<div class="view-container">
  <div class="header-products-view">
    <h2>Dulce Creams</h2>
    <span class="total-label">
    <strong>Total:</strong> {{ formArrayProducts.value | totalPrice }}
  </span>
  </div>

  <div  *ngIf="products()?.length">
    <form [formGroup]="productsForm">
      <div formArrayName="products" class="products-container">
        <mat-card
          class="product-card"
          [ngClass]="{ 'product-selected': product.value.selected }"
          (click)="selectProduct(i)"
          *ngFor="let product of formArrayProducts.controls; let i = index" [formGroupName]="i">
          <img *ngIf="product.get('image')?.value" ngSrc="{{product.get('image')?.value}}" class="product-image" width="150" height="250"
               alt="{{product.get('image')?.value}}"/>
          <mat-card-content>
            <h3 class="product-name">{{ product.get('name')?.value }}</h3>
            <p class="product-description">{{ product.get('description')?.value }}</p>
            <div class="product-price">$ {{ product.get('price')?.value }}</div>

            <!-- Cantidad -->
            <div class="quantity-selector" (click)="$event.stopPropagation()">
              <button (click)="decrement(i)">âˆ’</button>
              <input type="number" formControlName="quantity" min="1" />
              <button (click)="increment(i)">+</button>
            </div>
            <!-- Toppings opcionales -->
            <div class="toppings" (click)="$event.stopPropagation()" formArrayName="toppings">
              <div *ngFor="let top of toppingList(i).controls; let indexTop = index" [formGroupName]="indexTop">
                <mat-checkbox formControlName="selected">{{top.get('name')?.value}} </mat-checkbox>
              </div>
            </div>
          </mat-card-content>
          <div class="container-other-buttons" (click)="$event.stopPropagation()">
            <button mat-raised-button class="other-product-button"
                    *ngIf="!(product.value | validProductsSelected: products() ?? [])"
                    (click)="remove(i)">
              <mat-icon class="material-icons color-red">delete</mat-icon> <span class="color-red">Remover</span>
            </button>
            <button mat-flat-button class="other-product-button"
                    [disabled]="!product.value.selected"
                    (click)="$event.stopPropagation(); addOther(product.value, i)">
              <mat-icon class="material-icons">add_circle</mat-icon> Otro
            </button>
          </div>
        </mat-card>
      </div>
    </form>
  </div>

  <div class="cancel-button-container">
    <p class="quantity-selected">
      Total Pedidos: {{totalProductsSelected}} </p>
    <div>
      <button class="margin-2-px" mat-stroked-button (click)="goBack.emit()">Cancelar</button>
      <button class="margin-2-px" mat-flat-button [disabled]="!someProductSelected"
              (click)="sendOrder()">Hacer Pedido</button>
    </div>
  </div>
</div>















